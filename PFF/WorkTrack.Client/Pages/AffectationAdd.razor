@* @page "/affectations/add"
@inject IAffectationsService AffectationsService
@inject NavigationManager Nav
@inject IJSRuntime JS
@inject HttpClient Http

<h3 class="text-center mb-4">➕ Nouvelle Affectation</h3>

@if (_loading)
{
    <p>Chargement des données...</p>
}
else

{
    <EditForm Model="_model" OnValidSubmit="OnSubmitAsync">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div class="mb-3">
            <label>Module</label>
            <select class="form-select" @bind="_model.ModuleId">
                @foreach (var m in _modules)
                {
                    <option value="@m.Id">@m.Nom</option>
                }
            </select>
        </div>

        <div class="mb-3">
            <label>Promotion</label>
            <select class="form-select" @bind="_model.PromotionId">
                @foreach (var p in _promotions)
                {
                    <option value="@p.Id">@p.Nom (@p.AnneeScolaire)</option>
                }
            </select>
        </div>

        <div class="mb-3">
            <label>Enseignant</label>
            <select class="form-select" @bind="_model.EnseignantId">
                @foreach (var e in _enseignants)
                {
                    <option value="@e.Id">@e.Prenom @e.Nom</option>
                    <select class="form-select" @bind="_model.EnseignantId">
                }
            </select>
        </div>

        <div class="mb-3">
            <label>Semestre</label>
            <select class="form-select" @bind="_model.SemestreId">
                @foreach (var s in _semestres)
                {
                    <option value="@s.Id">@s.Libelle</option>
                }
            </select>
        </div>

        <div class="mb-3">
            <label>Volume horaire prévu</label>
            <InputNumber @bind-Value="_model.VolumeHorairePrevu" class="form-control" />
        </div>

        <div class="mb-3">
            <label>Date début</label>
            <InputDate @bind-Value="_model.DateDebut" class="form-control" />
        </div>

        <div class="mb-3">
            <label>Date fin</label>
            <InputDate @bind-Value="_model.DateFin" class="form-control" />
        </div>

        <button class="btn btn-primary" type="submit">Enregistrer</button>
        <button class="btn btn-secondary ms-2" type="button" @onclick="Annuler">Annuler</button>
    </EditForm>
}

@code {
    private AffectationModuleDto _model = new();
    private List<ModuleDto> _modules = new();
    private List<PromotionDto> _promotions = new();
    private List<EnseignantDto> _enseignants = new();
    private List<SemestreDto> _semestres = new();
    private bool _loading = true;

    protected override async Task OnInitializedAsync()
    {
        _modules = await Http.GetFromJsonAsync<List<ModuleDto>>("api/modules") ?? new();
        _promotions = await Http.GetFromJsonAsync<List<PromotionDto>>("api/promotions") ?? new();
        _enseignants = await Http.GetFromJsonAsync<List<EnseignantDto>>("api/enseignants") ?? new();
        _semestres = await Http.GetFromJsonAsync<List<SemestreDto>>("api/semestres") ?? new();
        _loading = false;
    }

    private async Task OnSubmitAsync()
    {
        var ok = await AffectationsService.CreateAsync(_model);
        if (ok)
        {
            await JS.InvokeVoidAsync("alert", "✅ Affectation enregistrée !");
            Nav.NavigateTo("/affectations");
        }
        else
        {
            await JS.InvokeVoidAsync("alert", "Erreur lors de l'enregistrement.");
        }
    }

    private void Annuler() => Nav.NavigateTo("/affectations");
} *@


@page "/affectations/add"
@inject IAffectationsService AffectationsService
@inject NavigationManager Nav
@inject IJSRuntime JS
@inject HttpClient Http

<h3 class="text-center mb-4">➕ Nouvelle Affectation</h3>

@if (_loading)
{
    <p>Chargement des données...</p>
}
else
{
    <EditForm Model="_model" OnValidSubmit="OnSubmitAsync">
        <DataAnnotationsValidator />
        <ValidationSummary />

    
        <div class="mb-3">
            <label>Module</label>
            <select class="form-select" @bind="_model.ModuleId">
           

           

                @foreach (var m in _modules)
                {
                    <option value="@m.Id">@m.Nom</option>
                }
            </select>
        </div>

        <div class="mb-3">
            <label>Promotion</label>
            <select class="form-select" @bind="_model.PromotionId">
                @foreach (var p in _promotions)
                {
                    <option value="@p.Id">@p.Nom (@p.AnneeScolaire)</option>
                }
            </select>
        </div>

        <div class="mb-3">
            <label>Enseignant</label>
            <select class="form-select" @bind="_model.EnseignantId">
                @foreach (var e in _enseignants)
                {
                    <option value="@e.Id">@e.Prenom @e.Nom</option>
                }
            </select>
        </div>

        <div class="mb-3">
            <label>Semestre</label>
            <select class="form-select" @bind="_model.SemestreId">
                @foreach (var s in _semestres)
                {
                    <option value="@s.Id">@s.Libelle</option>
                }
            </select>
        </div>

        <div class="mb-3">
            <label>Volume horaire prévu</label>
            <InputNumber @bind-Value="_model.VolumeHorairePrevu" class="form-control" />
        </div>

        <div class="mb-3">
            <label>Date début</label>
            <InputDate @bind-Value="_model.DateDebut" class="form-control" />
        </div>

        <div class="mb-3">
            <label>Date fin</label>
            <InputDate @bind-Value="_model.DateFin" class="form-control" />
        </div>

    

        <button class="btn btn-primary" type="submit">Enregistrer</button>
        <button class="btn btn-secondary ms-2" type="button" @onclick="Annuler">Annuler</button>
    </EditForm>
}

@code {
    private AffectationModuleDto _model = new();
    private List<ModuleDto> _modules = new();
    private List<PromotionDto> _promotions = new();
    private List<EnseignantDto> _enseignants = new();
    private List<SemestreDto> _semestres = new();
    private bool _loading = true;

    protected override async Task OnInitializedAsync()
    {
        _modules = await Http.GetFromJsonAsync<List<ModuleDto>>("api/modules") ?? new();
        _promotions = await Http.GetFromJsonAsync<List<PromotionDto>>("api/promotions") ?? new();
        _enseignants = await Http.GetFromJsonAsync<List<EnseignantDto>>("api/enseignants") ?? new();
        _semestres = await Http.GetFromJsonAsync<List<SemestreDto>>("api/semestres") ?? new();
        _loading = false;
    }

    private async Task OnSubmitAsync()
    {
        var ok = await AffectationsService.CreateAsync(_model);
        if (ok)
        {
            await JS.InvokeVoidAsync("alert", "✅ Affectation enregistrée !");
            Nav.NavigateTo("/affectations");
        }
        else
        {
            await JS.InvokeVoidAsync("alert", "❌ Erreur lors de l'enregistrement.");
        }
    }

    private void Annuler() => Nav.NavigateTo("/affectations");
}
